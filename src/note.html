<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ノート</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --note-color: #fef3c7;
            --line-height: 1.4;
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--note-color);
            min-height: 100vh;
            font-family: 'Inter', 'Noto Sans JP', system-ui, sans-serif;
        }

        .note-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: var(--note-color);
        }

        .note-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 12px;
            background: rgba(0, 0, 0, 0.05);
            cursor: move;
            -webkit-app-region: drag;
            user-select: none;
        }

        .note-header .title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 70%;
        }

        .note-header .actions {
            display: flex;
            gap: 4px;
            -webkit-app-region: no-drag;
        }

        .note-header .actions button {
            background: transparent;
            border: none;
            padding: 4px 8px;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            opacity: 0.7;
            transition: all 0.15s;
        }

        .note-header .actions button:hover {
            background: rgba(0, 0, 0, 0.1);
            opacity: 1;
        }

        .note-header .actions button.delete:hover {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
        }

        .note-editor {
            flex: 1;
            overflow: auto;
            padding: 8px 12px;
        }

        .note-editor #editor {
            min-height: 100%;
            max-width: none !important;
            margin: 0 !important;
        }

        .note-editor #editor .ProseMirror {
            outline: none;
            min-height: 100%;
            padding: 0 !important;
            margin: 0 !important;
        }

        .note-footer {
            padding: 4px 12px;
            font-size: 11px;
            color: rgba(0, 0, 0, 0.4);
            background: rgba(0, 0, 0, 0.03);
            display: flex;
            justify-content: space-between;
        }

        /* Override Milkdown styles for sticky note look */
        .note-editor .milkdown {
            background: transparent !important;
            padding: 0 !important;
            margin: 0 !important;
            max-width: none !important;
        }

        .note-editor .crepe {
            background: transparent !important;
            padding: 0 !important;
            margin: 0 !important;
            max-width: none !important;
        }

        .note-editor .ProseMirror {
            background: transparent !important;
            color: #1a1a1a;
        }

        .note-editor h1,
        .note-editor h2,
        .note-editor h3 {
            color: #333;
        }

        .note-editor code {
            background: rgba(0, 0, 0, 0.08);
        }

        .note-editor blockquote {
            border-left-color: rgba(0, 0, 0, 0.2);
            color: #444;
        }

        /* List styling for note editor - fix bullet display */
        .note-editor ul,
        .note-editor ol {
            padding-left: 1em !important;
            margin: 0.3em 0 !important;
        }

        .note-editor #editor li {
            margin: 0.1em 0 !important;
            display: flex !important;
            align-items: baseline !important;
            list-style: none !important;
        }

        /* Hide Milkdown's internal bullet markers */
        .note-editor .label-wrapper {
            display: none !important;
        }

        /* Custom bullet for unordered lists */
        .note-editor #editor ul li::before {
            content: "\2022" !important;
            margin-right: 0.3em;
            color: #333;
        }

        /* Custom number for ordered lists */
        .note-editor #editor ol {
            counter-reset: list-counter;
        }

        .note-editor #editor ol li {
            counter-increment: list-counter;
        }

        .note-editor #editor ol li::before {
            content: counter(list-counter) "." !important;
            margin-right: 0.3em;
            color: #333;
        }

        /* Mode indicator */
        .mode-badge {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 500;
            background: rgba(0, 0, 0, 0.1);
        }

        .mode-badge.editor-mode {
            background: rgba(59, 130, 246, 0.2);
            color: #1d4ed8;
        }

        /* Source editor for note */
        .note-source-container {
            flex: 1;
            display: none;
            overflow: hidden;
        }

        .note-source-container.active {
            display: flex;
        }

        .note-source-container textarea {
            flex: 1;
            border: none;
            padding: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.5;
            resize: none;
            background: #11111b;
            color: #cdd6f4;
        }

        .note-source-container textarea:focus {
            outline: none;
        }

        .note-editor.hidden {
            display: none;
        }

        /* Settings Panel */
        .settings-panel {
            position: absolute;
            top: 40px;
            right: 12px;
            background: #fff;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
            width: 200px;
        }

        .settings-panel.hidden {
            display: none;
        }

        .setting-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: #333;
        }

        .setting-item input[type="range"] {
            flex: 1;
        }

        .color-palette {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            box-shadow: 0 0 0 2px #3b82f6;
        }
    </style>
</head>

<body>
    <div class="note-container">
        <header class="note-header" data-tauri-drag-region>
            <span class="title" id="note-title">ノート</span>
            <div class="actions">
                <button id="btn-export" title="Markdownとして保存 (エクスポート)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <button id="btn-settings" title="設定">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path
                            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z">
                        </path>
                    </svg>
                </button>
                <button id="btn-toggle" title="モード切替 (Ctrl+/)">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                </button>
                <button id="btn-delete" class="delete" title="削除">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        <line x1="10" y1="11" x2="10" y2="17"></line>
                        <line x1="14" y1="11" x2="14" y2="17"></line>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Settings Panel -->
        <div id="settings-panel" class="settings-panel hidden">
            <div class="setting-item">
                <label>行間</label>
                <input type="range" id="line-height-range" min="0.8" max="2.0" step="0.1" value="1.4">
                <span id="line-height-value">1.4</span>
            </div>
            <div class="setting-item" style="margin-top: 12px; flex-direction: column; align-items: flex-start;">
                <label style="margin-bottom: 8px;">ノートの色</label>
                <div class="color-palette">
                    <div class="color-option" data-color="#fef3c7" style="background: #fef3c7;"></div>
                    <div class="color-option" data-color="#d1fae5" style="background: #d1fae5;"></div>
                    <div class="color-option" data-color="#dbeafe" style="background: #dbeafe;"></div>
                    <div class="color-option" data-color="#fce7f3" style="background: #fce7f3;"></div>
                    <div class="color-option" data-color="#e9d5ff" style="background: #e9d5ff;"></div>
                    <div class="color-option" data-color="#ffffff" style="background: #ffffff; border: 1px solid #ddd;">
                    </div>
                </div>
            </div>
        </div>

        <main class="note-editor" id="editor-container">
            <div id="editor">
                <div contenteditable="true" style="min-height: 100%; padding: 8px; outline: none;">読み込み中...</div>
            </div>
        </main>
        <div class="note-source-container" id="source-container">
            <textarea id="source-editor" spellcheck="false" placeholder="Markdownを入力..."></textarea>
        </div>
        <footer class="note-footer">
            <span id="save-status">保存済み</span>
            <span id="mode-indicator" class="mode-badge">WYSIWYG</span>
        </footer>
    </div>
    <script type="module" src="/note.ts"></script>
</body>

</html>